<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="text/javascript" src="form.js"></script>
    <link rel="stylesheet" href="styles.css">
    <title>Купить или продать елки</title>
</head>
<body>

<header>
    <div class="logo" id="headerTitle">Купить или продать елки</div>
    <a href="#" class="back-link">назад</a>
</header>

<div class="form-container">
    <form id="userForm">
        <!-- Имя пользователя -->
        <div class="form-group">
            <label for="name">Имя:</label>
            <input type="text" id="name" name="name" readonly required>
        </div>

        <!-- Фамилия пользователя -->
        <div class="form-group">
            <label for="lastname">Фамилия:</label>
            <input type="text" id="lastname" name="lastname" readonly required>
        </div>

        <!-- Логин пользователя -->
        <div class="form-group">
            <label for="username">Логин:</label>
            <input type="text" id="username" name="username" readonly required>
        </div>

        <!-- Телефон пользователя (если доступен) -->
        <div class="form-group">
            <label for="phone">Телефон:</label>
            <input type="text" id="phone" name="phone" readonly>
        </div>

        <!-- Количество лотов -->
        <div class="form-group">
            <label for="lots">Количество лотов:</label>
            <input type="number" id="lots" name="lots" required>
        </div>

        <!-- Цена за лот -->
        <div class="form-group">
            <label for="price">Цена за лот:</label>
            <input type="number" id="price" name="price" required>
        </div>

        <!-- Кнопка отправки -->
        <button type="submit" class="btn">Отправить</button>
    </form>
</div>

<script type="text/javascript">
    // Инициализация Telegram Web App
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Функция для получения параметра из URL
    function getURLParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    // Функция для установки правильного заголовка в зависимости от параметра 'action'
    function setHeaderTitle() {
        const action = getURLParameter('action');
        const headerTitle = document.getElementById('headerTitle');
        if (action === 'buy') {
            document.title = 'Хочу купить елки';
            headerTitle.textContent = 'Хочу купить елки';  // Изменяем текст заголовка
        } else if (action === 'sell') {
            document.title = 'Хочу продать елки';
            headerTitle.textContent = 'Хочу продать елки';  // Изменяем текст заголовка
        } else {
            document.title = 'Купить или продать елки';  // Заголовок по умолчанию
            headerTitle.textContent = 'Купить или продать елки';  // Заголовок по умолчанию
        }
    }

    // Вызов функции при загрузке страницы
    window.onload = function () {
        setHeaderTitle();
        getUserData();  // Вызываем функцию для загрузки данных пользователя
    };

    // Функция для получения данных пользователя из Telegram
    function getUserData() {
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            const user = tg.initDataUnsafe.user;
            const { first_name, last_name, username, phone_number, id, chat_id } = user;

            // Вставляем данные в поля формы
            if (first_name) {
                document.getElementById('name').value = first_name;
            }
            if (last_name) {
                document.getElementById('lastname').value = last_name;
            }
            if (username) {
                document.getElementById('username').value = username;
            }
            if (phone_number) {
                document.getElementById('phone').value = phone_number;
            }

            // Можно задать значения по умолчанию для полей "Количество лотов" и "Цена за лот", если необходимо
            document.getElementById('lots').value = 1;  // Пример: задать 1 лот по умолчанию
            document.getElementById('price').value = 100;  // Пример: задать 100 за лот по умолчанию
        }
    }

    // Логика отправки данных формы
    document.getElementById('userForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(this);
        // Пример отправки данных на сервер
        fetch('https://your-server-endpoint.com', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: formData.get('name'),
                lastname: formData.get('lastname'),
                username: formData.get('username'),
                phone: formData.get('phone'),
                lots: formData.get('lots'),
                price: formData.get('price'),
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log('Данные отправлены успешно:', data);
        })
        .catch(error => {
            console.error('Ошибка при отправке данных:', error);
        });
    });
</script>

</body>
</html>
